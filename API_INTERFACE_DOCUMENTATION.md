# Chaté¡¹ç›®æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº†Chaté¡¹ç›®ä¸­æ‰€æœ‰APIæ¥å£çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€å¥½å‹ç®¡ç†ã€èŠå¤©æ¶ˆæ¯ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä»¥åŠæ–°å¢çš„å·¥ä½œæµã€èµ„è®¯çƒ­ç‚¹ç­‰æ¨¡å—æ¥å£ã€‚

## ğŸ”§ åŸºç¡€é…ç½®

### æœåŠ¡å™¨é…ç½®
- **å¼€å‘ç¯å¢ƒ**: `localhost:8888`
- **ç”Ÿäº§ç¯å¢ƒ**: `8.137.19.65:8080`
- **WebSocketç«¯å£**: `9090`

### è®¤è¯æ–¹å¼
- **è®¤è¯ç±»å‹**: JWT Token
- **è¯·æ±‚å¤´**: `Authorization: Bearer <JWT_TOKEN>`
- **Tokenå­˜å‚¨**: æ”¯æŒå¤šç”¨æˆ·Tokenç®¡ç†

---

## ğŸ” ç”¨æˆ·è®¤è¯ç›¸å…³æ¥å£

### 1. ç”¨æˆ·æ³¨å†Œ

**æ¥å£åœ°å€**: `POST /api/v1/user/register`

**åŠŸèƒ½æè¿°**: ç”¨æˆ·æ³¨å†Œæ–°è´¦å·

**è¯·æ±‚å‚æ•°**:
```json
{
  "username": "ç”¨æˆ·å",
  "password": "å¯†ç ", 
  "passwordConfirm": "ç¡®è®¤å¯†ç ",
  "ip": "IPåœ°å€",
  "handlerName": "Register"
}
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": "æ³¨å†ŒæˆåŠŸä¿¡æ¯",
  "msg": "æ“ä½œç»“æœæè¿°"
}
```

**é”™è¯¯ç **:
- `400`: å‚æ•°é”™è¯¯
- `409`: ç”¨æˆ·åå·²å­˜åœ¨
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

### 2. ç”¨æˆ·ç™»å½•

**æ¥å£åœ°å€**: `POST /api/v1/user/login`

**åŠŸèƒ½æè¿°**: ç”¨æˆ·ç™»å½•è·å–JWT Token

**è¯·æ±‚å‚æ•°**:
```json
{
  "accountNum": "è´¦å·",
  "password": "å¯†ç ",
  "ip": "IPåœ°å€",
  "handlerName": "Login"
}
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "accountNum": "è´¦å·",
    "name": "ç”¨æˆ·å"
  },
  "msg": "ç™»å½•æˆåŠŸ"
}
```

**å“åº”å¤´**:
- `Authorization: Bearer <JWT_TOKEN>`

**é”™è¯¯ç **:
- `401`: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
- `400`: å‚æ•°é”™è¯¯
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

### 3. ç”¨æˆ·ç™»å‡º

**æ¥å£åœ°å€**: `POST /api/v1/user/logoff`

**åŠŸèƒ½æè¿°**: ç”¨æˆ·ç™»å‡ºï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€

**è¯·æ±‚å‚æ•°**:
```json
{
  "accountNum": "è´¦å·",
  "password": "å¯†ç ",
  "ip": "IPåœ°å€",
  "handlerName": "LogOff"
}
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": null,
  "msg": "ç™»å‡ºæˆåŠŸ"
}
```

**è¯·æ±‚å¤´**: `Authorization: Bearer <JWT_TOKEN>`

---

### 4. è·å–ç”¨æˆ·ä¿¡æ¯

**æ¥å£åœ°å€**: `GET /api/v1/user/info?account_num={accountNum}`

**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- `accountNum` (query): ç”¨æˆ·è´¦å·

**è¯·æ±‚å¤´**: `Authorization: Bearer <JWT_TOKEN>`

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "account_num": "è´¦å·",
    "name": "ç”¨æˆ·å",
    "desc": "ä¸ªäººç®€ä»‹",
    "email": "é‚®ç®±",
    "phone": "æ‰‹æœºå·",
    "avatar_url": "å¤´åƒURL",
    "create_at": "æ³¨å†Œæ—¶é—´",
    "lastLogin": "æœ€åç™»å½•æ—¶é—´",
    "ip": "IPåœ°å€",
    "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
    "level": 1,
    "stats": {
        "friends_count": 10,
        "workflow_count": 5
    }
  },
  "msg": "è·å–æˆåŠŸ"
}
```

---

### 5. ä¸Šä¼ å¤´åƒ

**æ¥å£åœ°å€**: `POST /api/v1/user/upload-avatar`

**åŠŸèƒ½æè¿°**: ä¸Šä¼ ç”¨æˆ·å¤´åƒ

**è¯·æ±‚ä½“**: `FormData`
- `avatar`: å›¾ç‰‡æ–‡ä»¶
- `account_num`: ç”¨æˆ·è´¦å·

**è¯·æ±‚å¤´**: `Authorization: Bearer <JWT_TOKEN>`

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "avatarUrl": "å¤´åƒURL",
    "url": "å¤´åƒURL"
  },
  "msg": "ä¸Šä¼ æˆåŠŸ"
}
```

**æ–‡ä»¶é™åˆ¶**:
- æ–‡ä»¶ç±»å‹: å›¾ç‰‡æ ¼å¼
- æ–‡ä»¶å¤§å°: æœ€å¤§5MB

---

### 5.1 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**æ¥å£åœ°å€**: `PUT /api/v1/user/info`

**åŠŸèƒ½æè¿°**: æ›´æ–°ç”¨æˆ·çš„ä¸ªäººèµ„æ–™

**è¯·æ±‚å‚æ•°**:
```json
{
  "name": "æ–°æ˜µç§°",
  "desc": "æ–°ç®€ä»‹",
  "email": "new@email.com",
  "phone": "13800000000",
  "location": "åŸå¸‚"
}
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ"
}
```

---

### 5.2 å…¨ç½‘ç”¨æˆ·æœç´¢

**æ¥å£åœ°å€**: `GET /api/v1/user/search`

**åŠŸèƒ½æè¿°**: æ ¹æ®å…³é”®è¯æœç´¢å…¨ç½‘ç”¨æˆ·

**è¯·æ±‚å‚æ•°**:
- `keyword` (query): æœç´¢å…³é”®è¯

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": [
    {
      "accountNum": "è´¦å·",
      "name": "ç”¨æˆ·å",
      "avatarUrl": "å¤´åƒURL",
      "isFriend": false,
      "tags": ["æ ‡ç­¾1"]
    }
  ],
  "msg": "è·å–æˆåŠŸ"
}
```

---

## ğŸ‘¥ å¥½å‹ç®¡ç†ç›¸å…³æ¥å£

### 6. è·å–å¥½å‹åˆ—è¡¨

**æ¥å£åœ°å€**: `POST /api/v1/friend/list`

**åŠŸèƒ½æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "accountNum": "å½“å‰ç”¨æˆ·è´¦å·",
  "handlerName": "GetFriends"
}
```

**è¯·æ±‚å¤´**: `Authorization: Bearer <JWT_TOKEN>`

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": [
    {
      "accountNum": "å¥½å‹è´¦å·",
      "name": "å¥½å‹ç”¨æˆ·å",
      "desc": "å¥½å‹ç®€ä»‹",
      "avatarUrl": "å¥½å‹å¤´åƒURL",
      "isOnline": true,
      "lastMessage": "æœ€åä¸€æ¡æ¶ˆæ¯",
      "unreadCount": 0
    }
  ],
  "msg": "è·å–æˆåŠŸ"
}
```

---

### 8. é€šè¿‡è´¦å·æ·»åŠ å¥½å‹

**æ¥å£åœ°å€**: `POST /api/v1/friend/addition/with_account_num`

**åŠŸèƒ½æè¿°**: é€šè¿‡æŒ‡å®šè´¦å·æ·»åŠ å¥½å‹

**è¯·æ±‚å‚æ•°**:
```json
{
  "accountNum": "å½“å‰ç”¨æˆ·è´¦å·",
  "targetAccountNum": "ç›®æ ‡ç”¨æˆ·è´¦å·",
  "handlerName": "AddFriendWithAccountNum"
}
```

**è¯·æ±‚å¤´**: `Authorization: Bearer <JWT_TOKEN>`

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "accountNum": "ç›®æ ‡ç”¨æˆ·è´¦å·",
    "name": "ç›®æ ‡ç”¨æˆ·å"
  },
  "msg": "æ·»åŠ æˆåŠŸ"
}
```

**é”™è¯¯ç **:
- `404`: ç›®æ ‡ç”¨æˆ·ä¸å­˜åœ¨
- `409`: å·²ç»æ˜¯å¥½å‹å…³ç³»
- `400`: ä¸èƒ½æ·»åŠ è‡ªå·±ä¸ºå¥½å‹

---

## ğŸ’¬ èŠå¤©æ¶ˆæ¯ç›¸å…³æ¥å£

### 9. åˆ·æ–°èŠå¤©è®°å½•

**æ¥å£åœ°å€**: `POST /api/v1/chat/text/refresh`

**åŠŸèƒ½æè¿°**: è·å–ä¸æŒ‡å®šå¥½å‹çš„èŠå¤©è®°å½•

**è¯·æ±‚å‚æ•°**:
```json
{
  "SenderAccountNum": "å‘é€è€…è´¦å·",
  "ReceiverAccountNum": "æ¥æ”¶è€…è´¦å·",
  "handlerName": "RefreshText"
}
```

**è¯·æ±‚å¤´**: `Authorization: Bearer <JWT_TOKEN>`

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "text": {
      "content": [
        {
          "content": "æ¶ˆæ¯å†…å®¹",
          "senderAccountNum": "å‘é€è€…è´¦å·",
          "receiverAccountNum": "æ¥æ”¶è€…è´¦å·",
          "timestamp": "å‘é€æ—¶é—´"
        }
      ]
    }
  },
  "msg": "è·å–æˆåŠŸ"
}
```

---

### 10. WebSocketèŠå¤©è¿æ¥

**æ¥å£åœ°å€**: `WS /api/v1/chat/ws?token={JWT_TOKEN}`

**åŠŸèƒ½æè¿°**: å»ºç«‹WebSocketè¿æ¥è¿›è¡Œå®æ—¶èŠå¤©

**è¿æ¥å‚æ•°**:
- `token`: JWT Token

**æ¶ˆæ¯ç±»å‹**:

#### å‘é€æ¶ˆæ¯æ ¼å¼:
```json
{
  "data": "æ¶ˆæ¯å†…å®¹",
  "accountNum": "å‘é€è€…è´¦å·",
  "receiver": "æ¥æ”¶è€…è´¦å·",
  "type": "SendText"
}
```

#### æ¥æ”¶æ¶ˆæ¯æ ¼å¼:
```json
{
  "data": "æ¶ˆæ¯å†…å®¹",
  "accountNum": "å‘é€è€…è´¦å·",
  "receiver": "æ¥æ”¶è€…è´¦å·",
  "type": "SendText"
}
```

**æ”¯æŒçš„æ¶ˆæ¯ç±»å‹**:
- `SendText`: å‘é€æ–‡æœ¬æ¶ˆæ¯
- `RefreshText`: åˆ·æ–°æ¶ˆæ¯
- `Login`: ç™»å½•æ¶ˆæ¯
- `LogOff`: ç™»å‡ºæ¶ˆæ¯
- `Register`: æ³¨å†Œæ¶ˆæ¯
- `kick`: è¸¢å‡ºç”¨æˆ·æ¶ˆæ¯
- `error`: é”™è¯¯æ¶ˆæ¯

---

## ğŸ”„ å·¥ä½œæµ (Workflow) ç›¸å…³æ¥å£

### 11. è·å–å·¥ä½œæµåˆ—è¡¨

**æ¥å£åœ°å€**: `GET /api/v1/workflows`

**åŠŸèƒ½æè¿°**: è·å–å·¥ä½œæµåˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œç­›é€‰

**è¯·æ±‚å‚æ•°**:
- `page`: é¡µç  (é»˜è®¤1)
- `pageSize`: æ¯é¡µæ•°é‡ (é»˜è®¤10)
- `keyword`: æœç´¢å…³é”®è¯ (å¯é€‰)
- `category`: åˆ†ç±» (å¯é€‰)

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": "wf_001",
        "name": "æ—¥æŠ¥è‡ªåŠ¨ç”Ÿæˆ",
        "description": "è‡ªåŠ¨æ±‡æ€»æ¯æ—¥å·¥ä½œå†…å®¹ç”Ÿæˆæ—¥æŠ¥",
        "icon": "ğŸ“",
        "tags": ["åŠå…¬", "è‡ªåŠ¨åŒ–"],
        "author": "System",
        "usageCount": 1200
      }
    ],
    "total": 50
  },
  "msg": "è·å–æˆåŠŸ"
}
```

### 12. è·å–å·¥ä½œæµè¯¦æƒ…

**æ¥å£åœ°å€**: `GET /api/v1/workflows/{id}`

**åŠŸèƒ½æè¿°**: è·å–æŒ‡å®šå·¥ä½œæµçš„è¯¦ç»†ä¿¡æ¯å’Œé…ç½®

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "id": "wf_001",
    "name": "æ—¥æŠ¥è‡ªåŠ¨ç”Ÿæˆ",
    "steps": [
      { "name": "æ‹‰å–Gitæäº¤", "type": "git_pull" },
      { "name": "ç”Ÿæˆæ‘˜è¦", "type": "ai_summary" }
    ]
  },
  "msg": "è·å–æˆåŠŸ"
}
```

### 13. æ‰§è¡Œå·¥ä½œæµ

**æ¥å£åœ°å€**: `POST /api/v1/workflows/{id}/execute`

**åŠŸèƒ½æè¿°**: è§¦å‘ä¸€æ¬¡å·¥ä½œæµæ‰§è¡Œ

**è¯·æ±‚å‚æ•°**:
```json
{
  "params": {
    "date": "2023-10-27"
  }
}
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "executionId": "exec_123456",
    "status": "running"
  },
  "msg": "æ‰§è¡Œå·²å¯åŠ¨"
}
```

### 14. è·å–æ‰§è¡Œè®°å½•åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /api/v1/executions`

**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·çš„å·¥ä½œæµæ‰§è¡Œå†å²

**è¯·æ±‚å‚æ•°**:
- `page`: é¡µç 
- `pageSize`: æ¯é¡µæ•°é‡
- `status`: çŠ¶æ€ç­›é€‰ (success/failed/running)

### 15. è·å–æ‰§è¡Œè¯¦æƒ…

**æ¥å£åœ°å€**: `GET /api/v1/executions/{id}`

**åŠŸèƒ½æè¿°**: è·å–æŸæ¬¡å…·ä½“æ‰§è¡Œçš„è¯¦ç»†æ—¥å¿—å’Œæ­¥éª¤çŠ¶æ€

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "id": "exec_123456",
    "workflowId": "wf_001",
    "status": "success",
    "startTime": "2023-10-27 10:00:00",
    "endTime": "2023-10-27 10:00:05",
    "logs": ["Start execution...", "Step 1 completed"],
    "steps": [
      { "name": "Step 1", "status": "completed", "duration": "2s" }
    ]
  },
  "msg": "è·å–æˆåŠŸ"
}
```

### 16. å·¥ä½œæµç»Ÿè®¡æ•°æ®

**æ¥å£åœ°å€**: `GET /api/v1/workflow/stats`

**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·çš„å·¥ä½œæµæ‰§è¡Œç»Ÿè®¡æ¦‚è§ˆ

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": {
    "totalExecutions": 1258,
    "successRate": 98.5,
    "savedTime": 420,
    "recentRecords": []
  },
  "msg": "è·å–æˆåŠŸ"
}
```

### 17. æ“ä½œæ‰§è¡Œ (å–æ¶ˆ/æš‚åœ/é‡è¯•)

**æ¥å£åœ°å€**:
- å–æ¶ˆ: `POST /api/v1/executions/{id}/cancel`
- æš‚åœ: `POST /api/v1/executions/{id}/pause`
- é‡è¯•: `POST /api/v1/executions/{id}/retry`

---

## ğŸ“° èµ„è®¯ä¸çƒ­ç‚¹æ¥å£

### 18. è·å–ä»Šæ—¥çƒ­ç‚¹

**æ¥å£åœ°å€**: `GET /api/v1/news/hot`

**åŠŸèƒ½æè¿°**: è·å–èšåˆçš„çƒ­ç‚¹æ–°é—»æ•°æ®

**è¯·æ±‚å‚æ•°**:
- `category`: åˆ†ç±»æ ‡ç­¾ (å¦‚ "AIç§‘æŠ€", "æ¨è")

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "data": [
    {
      "id": 101,
      "title": "æ–°é—»æ ‡é¢˜",
      "summary": "æ–°é—»æ‘˜è¦",
      "source": "æ¥æº",
      "time": "å‘å¸ƒæ—¶é—´",
      "category": "åˆ†ç±»",
      "image": "å°é¢å›¾URL"
    }
  ],
  "msg": "è·å–æˆåŠŸ"
}
```

---

## ğŸ”§ é…ç½®ç›¸å…³æ¥å£

### 19. è·å–é…ç½®ä¿¡æ¯

**æ¥å£åœ°å€**: `GET /api/static/config.json`

**åŠŸèƒ½æè¿°**: è·å–æœåŠ¡å™¨é…ç½®ä¿¡æ¯

**å“åº”æ ¼å¼**:
```json
{
  "host": "localhost",
  "port": "8888"
}
```

### 20. é™æ€èµ„æº

**æ¥å£åœ°å€**: `GET /api/static/images/user-icon.png`

**åŠŸèƒ½æè¿°**: è·å–é»˜è®¤ç”¨æˆ·å¤´åƒ

---

## ğŸ“Š é€šç”¨å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "data": "å“åº”æ•°æ®",
  "msg": "æ“ä½œæˆåŠŸ"
}
```

### é”™è¯¯å“åº”
```json
{
  "code": é”™è¯¯ç ,
  "data": null,
  "msg": "é”™è¯¯ä¿¡æ¯"
}
```

### å¸¸è§é”™è¯¯ç 
- `200`: æˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªæˆæƒ/Tokenæ— æ•ˆ
- `403`: ç¦æ­¢è®¿é—®
- `404`: èµ„æºä¸å­˜åœ¨
- `409`: å†²çªï¼ˆå¦‚ç”¨æˆ·åå·²å­˜åœ¨ï¼‰
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

## ğŸ”’ å®‰å…¨è¯´æ˜

### JWT Tokenç®¡ç†
- Tokenå­˜å‚¨åœ¨localStorageå’ŒsessionStorageä¸­
- æ”¯æŒå¤šç”¨æˆ·Tokenç®¡ç†
- Tokenè¿‡æœŸéœ€è¦é‡æ–°ç™»å½•

### è¯·æ±‚å¤´è¦æ±‚
- æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«JWT Token
- æ ¼å¼: `Authorization: Bearer <JWT_TOKEN>`

### æ–‡ä»¶ä¸Šä¼ å®‰å…¨
- å¤´åƒä¸Šä¼ é™åˆ¶æ–‡ä»¶ç±»å‹ä¸ºå›¾ç‰‡
- æ–‡ä»¶å¤§å°é™åˆ¶ä¸º5MB
- æœåŠ¡å™¨ç«¯éœ€è¦éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰æ¥å£ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°æ—¶é—´: 2025å¹´11æœˆ*
